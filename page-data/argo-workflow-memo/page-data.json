{"componentChunkName":"component---src-templates-post-js","path":"/argo-workflow-memo/","result":{"data":{"site":{"siteMetadata":{"title":"mojaie.github.io","siteUrl":"https://mojaie.github.io","author":{"name":"Seiji Matsuoka","summary":"Cheminformatics, Biointeraction and Laboratory automation"},"license":"CC BY 4.0","licenseURL":"https://creativecommons.org/licenses/by/4.0/legalcode","social":{"twitter":"mojaie"}}},"markdownRemark":{"id":"04927e07-3178-5f50-93f3-9d47cdddc327","excerpt":"Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« Docker desktopã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•ã—ã¦ãŠãã¾ã™ã€‚ Minikubeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« (2020.06.05è¿½è¨˜) Docker desktopã«kubernetesãŒå«ã¾ã‚Œã‚‹ã®ã§ã€minikubeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªãã¦ã‚‚ã€Docker desktopâ€¦","html":"<h3>Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>\n<p>Docker desktopã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’èµ·å‹•ã—ã¦ãŠãã¾ã™ã€‚</p>\n<h3>Minikubeã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>\n<p>(2020.06.05è¿½è¨˜) Docker desktopã«kubernetesãŒå«ã¾ã‚Œã‚‹ã®ã§ã€minikubeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªãã¦ã‚‚ã€Docker desktopã®Preferences->Kubernetes->Enable Kubernetesã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨kubernetesãŒä½¿ãˆã¾ã™ã€‚ãã®å ´åˆã€ä»¥ä¸‹ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã€ŒArgoã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã€ã«é€²ã¿ã¾ã™ã€‚</p>\n<p>ä¸‹è¨˜ã‚’å‚è€ƒã«Minikubeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚HomeBrewã‚’ä½¿ã†ã¨æ¥½ã§ã™ã€‚<br>\n<a href=\"https://minikube.sigs.k8s.io/docs/start/\">https://minikube.sigs.k8s.io/docs/start/</a><br>\n<a href=\"https://kubernetes.io/ja/docs/tasks/tools/install-minikube/\">https://kubernetes.io/ja/docs/tasks/tools/install-minikube/</a></p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">brew update</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">brew <span class=\"token function\">install</span> minikube</span></span></code></pre></div>\n<p>minikube startã™ã‚‹ã¨hyperkit(Docker desktopã«å«ã¾ã‚Œã‚‹)ã®ãƒ‰ãƒ©ã‚¤ãƒã¨kubectlãŒè‡ªå‹•çš„ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">minikube start</span></span>\n<span class=\"token output\">ğŸ˜„  Darwin 10.15.4 ä¸Šã® minikube v1.10.1\nâœ¨  Automatically selected the hyperkit driver\nğŸ’¾  docker-machine-driver-hyperkit ãƒ‰ãƒ©ã‚¤ãƒã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™:\n    > docker-machine-driver-hyperkit.sha256: 65 B / 65 B [---] 100.00% ? p/s 0s\n    > docker-machine-driver-hyperkit: 10.90 MiB / 10.90 MiB  100.00% 29.23 KiB \nğŸ”‘  The 'hyperkit' driver requires elevated permissions. The following commands will be executed:\n\n</span><span class=\"token info punctuation\">    </span><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> root:wheel /Users/username/.minikube/bin/docker-machine-driver-hyperkit </span></span>\n<span class=\"token info punctuation\">    </span><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> u+s /Users/username/.minikube/bin/docker-machine-driver-hyperkit </span></span>\n\n<span class=\"token output\">Password:</span></code></pre></div>\n<p>sudoã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token output\">ğŸ’¿  VM ãƒ–ãƒ¼ãƒˆã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™...\n    > minikube-v1.10.0.iso.sha256: 65 B / 65 B [-------------] 100.00% ? p/s 0s\n    > minikube-v1.10.0.iso: 174.99 MiB / 174.99 MiB [] 100.00% 8.27 MiB p/s 21s\nğŸ‘  Starting control plane node minikube in cluster minikube\nğŸ’¾  Kubernetes v1.18.2 ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®æº–å‚™ã‚’ã—ã¦ã„ã¾ã™\n    > preloaded-images-k8s-v3-v1.18.2-docker-overlay2-amd64.tar.lz4: 525.43 MiB\nğŸ”¥  Creating hyperkit VM (CPUs=2, Memory=4000MB, Disk=20000MB) ...\nğŸ³  Docker 19.03.8 ã§ Kubernetes v1.18.2 ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...\nğŸ”  Verifying Kubernetes components...\nğŸŒŸ  Enabled addons: default-storageclass, storage-provisioner\nğŸ„  Done! kubectl is now configured to use \"minikube\"</span></code></pre></div>\n<p>ä»®æƒ³ç’°å¢ƒã‚’çµ‚äº†ã™ã‚‹ã¨ãã¯minikube stop</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">minikube stop</span></span></code></pre></div>\n<p>minikubeã®dockerç’°å¢ƒã‚’ç¢ºèªã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">minikube -p minikube docker-env</span></span>\n<span class=\"token output\">export DOCKER_TLS_VERIFY=\"1\"\nexport DOCKER_HOST=\"tcp://192.168.64.2:2376\"\nexport DOCKER_CERT_PATH=\"/Users/username/.minikube/certs\"\nexport MINIKUBE_ACTIVE_DOCKERD=\"minikube\"\n\n</span><span class=\"token command\"><span class=\"token shell-symbol important\">#</span> <span class=\"token bash language-bash\">To point your shell to minikube</span></span><span class=\"token output\">'s docker-daemon, run:\n</span><span class=\"token command\"><span class=\"token shell-symbol important\">#</span> <span class=\"token bash language-bash\"><span class=\"token builtin class-name\">eval</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>minikube -p minikube docker-env<span class=\"token variable\">)</span></span></span></span></code></pre></div>\n<p>minikubeã®Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’å†åˆ©ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã®Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\nä¸€æ—¦è¨­å®šã™ã‚Œã°Docker desktop.Appã‚’èµ·å‹•ã—ãªãã¦ã‚‚<code class=\"language-text\">minikube start</code>ã§è‡ªå‹•çš„ã«minikubeã®Dockerãƒ‡ãƒ¼ãƒ¢ãƒ³ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token builtin class-name\">eval</span> <span class=\"token variable\"><span class=\"token variable\">$(</span>minikube -p minikube docker-env<span class=\"token variable\">)</span></span></span></span></code></pre></div>\n<p>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’èµ·å‹•</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">minikube dashboard</span></span></code></pre></div>\n<h3>Argoã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>\n<p>getting started<br>\n<a href=\"https://argoproj.github.io/docs/argo/getting-started.html\">https://argoproj.github.io/docs/argo/getting-started.html</a></p>\n<p>ã“ã‚Œã‚‚HomeBrewã§å…¥ã‚Œã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">brew <span class=\"token function\">install</span> argoproj/tap/argo</span></span></code></pre></div>\n<p>Argoã®åå‰ç©ºé–“ã‚’ä½œæˆã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">kubectl create namespace argo</span></span>\n<span class=\"token output\">namespace/argo created</span></code></pre></div>\n<p>Argoã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">kubectl apply -n argo -f https://raw.githubusercontent.com/argoproj/argo/stable/manifests/install.yaml</span></span>\n<span class=\"token output\">customresourcedefinition.apiextensions.k8s.io/clusterworkflowtemplates.argoproj.io created\ncustomresourcedefinition.apiextensions.k8s.io/cronworkflows.argoproj.io created\ncustomresourcedefinition.apiextensions.k8s.io/workflows.argoproj.io created\ncustomresourcedefinition.apiextensions.k8s.io/workflowtemplates.argoproj.io created\nserviceaccount/argo created\nserviceaccount/argo-server created\nrole.rbac.authorization.k8s.io/argo-role created\nclusterrole.rbac.authorization.k8s.io/argo-aggregate-to-admin created\nclusterrole.rbac.authorization.k8s.io/argo-aggregate-to-edit created\nclusterrole.rbac.authorization.k8s.io/argo-aggregate-to-view created\nclusterrole.rbac.authorization.k8s.io/argo-cluster-role created\nclusterrole.rbac.authorization.k8s.io/argo-server-cluster-role created\nrolebinding.rbac.authorization.k8s.io/argo-binding created\nclusterrolebinding.rbac.authorization.k8s.io/argo-binding created\nclusterrolebinding.rbac.authorization.k8s.io/argo-server-binding created\nconfigmap/workflow-controller-configmap created\nservice/argo-server created\nservice/workflow-controller-metrics created\ndeployment.apps/argo-server created\ndeployment.apps/workflow-controller created</span></code></pre></div>\n<p>defaultãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã§adminã‚’è¨­å®šã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">kubectl create rolebinding default-admin --clusterrole<span class=\"token operator\">=</span>admin --serviceaccount<span class=\"token operator\">=</span>argo:default -n argo</span></span></code></pre></div>\n<p>Argoã®exampleã®ãƒšãƒ¼ã‚¸ã«ã‚ã‚‹workflowã®YAMLãƒ•ã‚¡ã‚¤ãƒ«ä¾‹(hello-world.yaml)ã‚’ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ãã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> argoproj.io/v1alpha1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Workflow                  <span class=\"token comment\"># new type of k8s spec</span>\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">generateName</span><span class=\"token punctuation\">:</span> hello<span class=\"token punctuation\">-</span>world<span class=\"token punctuation\">-</span>    <span class=\"token comment\"># name of the workflow spec</span>\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">entrypoint</span><span class=\"token punctuation\">:</span> whalesay          <span class=\"token comment\"># invoke the whalesay template</span>\n  <span class=\"token key atrule\">templates</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> whalesay              <span class=\"token comment\"># name of the template</span>\n    <span class=\"token key atrule\">container</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker/whalesay\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>cowsay<span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">]</span>\n      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>                <span class=\"token comment\"># limit the resources</span>\n        <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 32Mi\n          <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m</code></pre></div>\n<p>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚µãƒ–ãƒŸãƒƒãƒˆ</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo submit -n argo hello-world.yaml</span></span></code></pre></div>\n<p>ã‚ã‚‹ã„ã¯Webä¸Šã®ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ç›´æ¥submitã§ãã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo submit -n argo https://raw.githubusercontent.com/argoproj/argo/master/examples/hello-world.yaml</span></span></code></pre></div>\n<p>å®Ÿæ–½ä¸­ã®ã‚¸ãƒ§ãƒ–ä¸€è¦§ã‚’ç¢ºèª</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo list -n argo</span></span>\n<span class=\"token output\">NAME                STATUS      AGE   DURATION   PRIORITY\nhello-world-wzvfd   Succeeded   38s   8s         0</span></code></pre></div>\n<p>å®Ÿæ–½ä¸­ã®ã‚¸ãƒ§ãƒ–ã®çŠ¶æ…‹ã‚’ç¢ºèª</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo get -n argo hello-world-wzvfd</span></span>\n<span class=\"token output\">Name:                hello-world-wzvfd\nNamespace:           default\nServiceAccount:      default\nStatus:              Succeeded\nConditions:          \n Completed           True\nCreated:             Sun May 24 23:38:07 +0900 (20 seconds ago)\nStarted:             Sun May 24 23:38:07 +0900 (20 seconds ago)\nFinished:            Sun May 24 23:38:15 +0900 (12 seconds ago)\nDuration:            8 seconds\n\nSTEP                  TEMPLATE  PODNAME            DURATION  MESSAGE\n âœ” hello-world-wzvfd  whalesay  hello-world-wzvfd  6s   </span></code></pre></div>\n<p>çµæœã‚’ç¢ºèª</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo logs -n argo hello-world-wzvfd </span></span>\n<span class=\"token output\">hello-world-wzvfd:  _____________ \nhello-world-wzvfd: &lt; hello world >\nhello-world-wzvfd:  ------------- \nhello-world-wzvfd:     \\\nhello-world-wzvfd:      \\\nhello-world-wzvfd:       \\     \n</span><span class=\"token info punctuation\">hello-world-wzvfd<span class=\"token punctuation\">:</span><span class=\"token path\">                     </span></span><span class=\"token command\"><span class=\"token shell-symbol important\">#</span><span class=\"token bash language-bash\"><span class=\"token comment\">#        .            </span></span></span>\n<span class=\"token info punctuation\">hello-world-wzvfd<span class=\"token punctuation\">:</span><span class=\"token path\">               </span></span><span class=\"token command\"><span class=\"token shell-symbol important\">#</span><span class=\"token bash language-bash\"><span class=\"token comment\"># ## ##       ==            </span></span></span>\n<span class=\"token info punctuation\">hello-world-wzvfd<span class=\"token punctuation\">:</span><span class=\"token path\">            </span></span><span class=\"token command\"><span class=\"token shell-symbol important\">#</span><span class=\"token bash language-bash\"><span class=\"token comment\"># ## ## ##      ===            </span></span></span>\n<span class=\"token output\">hello-world-wzvfd:        /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"___/ ===        \nhello-world-wzvfd:   ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~   \nhello-world-wzvfd:        \\______ o          __/            \nhello-world-wzvfd:         \\    \\        __/             \nhello-world-wzvfd:           \\____\\______/   </span></code></pre></div>\n<p>ã‚¸ãƒ§ãƒ–ã®å‰Šé™¤</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo delete -n argo hello-world-wzvfd</span></span>\n<span class=\"token output\">Workflow 'hello-world-wzvfd' deleted</span></code></pre></div>\n<p>Webã§ç®¡ç†</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo -n argo server</span></span></code></pre></div>\n<!--\ndocker run --rm mainwfjl:local julia src/test.jl\ndocker ps\ndocker images\ndocker build -t mainwfjl:local .\nkubectl describe pod hello-world-kgxxb\n\ndocker system prune -all\ndocker volumes prune\n-->\n<h3>Minioã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>\n<p>(2020.06.09æ™‚ç‚¹)å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®æœ€æ–°ç‰ˆãŒã¾ã ã‚µã‚¤ãƒˆã«åæ˜ ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä»¥ä¸‹PRå‚ç…§<br>\n<a href=\"https://github.com/argoproj/argo/pull/3099/files\">https://github.com/argoproj/argo/pull/3099/files</a></p>\n<p>ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã®çµæœã‚’ä¸€æ™‚çš„ã«ä¿å­˜ã™ã‚‹ãŸã‚ã«ã€S3äº’æ›ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒå¿…è¦ã§ã™ã€‚ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã«å¾“ã£ã¦helmã‹ã‚‰Minioã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">brew <span class=\"token function\">install</span> helm</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">helm repo <span class=\"token function\">add</span> stable https://kubernetes-charts.storage.googleapis.com/</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">helm repo update</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">helm <span class=\"token function\">install</span> argo-artifacts stable/minio </span></span><span class=\"token output\">\\\n  -n argo \\\n  --set service.type=LoadBalancer \\\n  --set defaultBucket.enabled=true \\\n  --set defaultBucket.name=my-bucket \\\n  --set persistence.enabled=false \\\n  --set fullnameOverride=argo-artifacts \\\n\n  NAME: argo-artifacts\n  LAST DEPLOYED: Tue Jun  9 11:58:41 2020\n  NAMESPACE: argo\n  STATUS: deployed\n  REVISION: 1\n  TEST SUITE: None\n  NOTES:\n  Minio can be accessed via port 9000 on an external IP address. Get the service external IP address by:\n  kubectl get svc --namespace argo -l app=argo-artifacts\n\n  Note that the public IP may take a couple of minutes to be available.\n\n  You can now access Minio server on http://&lt;External-IP>:9000. Follow the below steps to connect to Minio server with mc client:\n\n    1. Download the Minio mc client - https://docs.minio.io/docs/minio-client-quickstart-guide\n\n    2. mc config host add argo-artifacts-local http://&lt;External-IP>:9000 AKIAIOSFODNN7EXAMPLE wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY S3v4\n\n    3. mc ls argo-artifacts-local\n\n  Alternately, you can use your browser or the Minio SDK to access the server - https://docs.minio.io/categories/17</span></code></pre></div>\n<p>argo-artifactã®ã‚µãƒ¼ãƒ“ã‚¹ã®IPã¨PORTã‚’ç¢ºèªã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">kubectl get <span class=\"token function\">service</span> argo-artifacts -o wide -n argo</span></span>\n<span class=\"token output\">NAME             TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE\nargo-artifacts   LoadBalancer   10.105.220.48   localhost     9000:32283/TCP   94s</span></code></pre></div>\n<p>minioã®Webã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒã‚±ãƒƒãƒˆ(my-bucket)ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚</p>\n<p>argo/workflow-controller-configmapã‚’ç·¨é›†ã—ã¾ã™ã€‚å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®è¨˜è¿°ã«å¾“ã„ã€configmapã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">data:\n  artifactRepository: |\n    s3:\n      bucket: my-bucket\n      endpoint: argo-artifacts:9000\n      insecure: true\n      # accessKeySecret and secretKeySecret are secret selectors.\n      # It references the k8s secret named &#39;argo-artifacts&#39;\n      # which was created during the minio helm install. The keys,\n      # &#39;accesskey&#39; and &#39;secretkey&#39;, inside that secret are where the\n      # actual minio credentials are stored.\n      accessKeySecret:\n        name: argo-artifacts\n        key: accesskey\n      secretKeySecret:\n        name: argo-artifacts\n        key: secretkey</code></pre></div>\n<p>ã‚ã‚‹ã„ã¯ã€ä¸Šè¨˜ã‚’è¿½è¨˜ã—ãŸconfigmapã®yamlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ãŠã„ã¦applyã—ã¾ã™ã€‚ãã®å ´åˆã€å…ƒã®configmapã«è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰æƒ…å ±ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰(<code class=\"language-text\">creationTimestamp</code>, <code class=\"language-text\">resourceVersion</code>, <code class=\"language-text\">uid</code>)ã¯æ¶ˆã—ã¦ãŠãã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token output\">kubectl apply -n argo -f workflow-controller-configmap.yaml</span></code></pre></div>\n<p>ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®artifact-passing.yamlã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo submit -n argo https://raw.githubusercontent.com/argoproj/argo/master/examples/artifact-passing.yaml</span></span>\n\n<span class=\"token output\">Name:                artifact-passing-58v85\nNamespace:           argo\nServiceAccount:      default\nStatus:              Pending\nCreated:             Tue Jun 09 20:37:56 +0900 (now)\n\n</span><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">argo get -n argo artifact-passing-58v85</span></span>\n<span class=\"token output\">Name:                artifact-passing-58v85\nNamespace:           argo\nServiceAccount:      default\nStatus:              Succeeded\nConditions:          \n Completed           True\nCreated:             Tue Jun 09 20:37:56 +0900 (23 seconds ago)\nStarted:             Tue Jun 09 20:37:56 +0900 (23 seconds ago)\nFinished:            Tue Jun 09 20:38:14 +0900 (5 seconds ago)\nDuration:            18 seconds\n\nSTEP                       TEMPLATE          PODNAME                            DURATION  MESSAGE\n âœ” artifact-passing-58v85  artifact-example                                                 \n â”œ---âœ” generate-artifact   whalesay          artifact-passing-58v85-1826744750  7s          \n â””---âœ” consume-artifact    print-message     artifact-passing-58v85-2028663838  8s   </span></code></pre></div>","fields":{"slug":"/argo-workflow-memo/"},"frontmatter":{"title":"Argoã®ç’°å¢ƒæ§‹ç¯‰(Mac OS X)","dateCreated":"May 19, 2020","dateModified":"June 09, 2020","tags":["Argo","Docker","Kubernetes","environment setup","Mac OS X"],"description":null}}},"pageContext":{"slug":"/argo-workflow-memo/","draft":false,"previous":{"fields":{"slug":"/julia-package-cleanup/"},"frontmatter":{"title":"ä¸è¦ãªJuliaã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å‰Šé™¤ã—ã¦ç©ºãå®¹é‡ã‚’ç¢ºä¿ã™ã‚‹","draft":false}},"next":null}}}