{"componentChunkName":"component---src-templates-post-js","path":"/singularity-memo/","result":{"data":{"site":{"siteMetadata":{"title":"mojaie.github.io","siteUrl":"https://mojaie.github.io","author":{"name":"Seiji Matsuoka","summary":"Cheminformatics, Biointeraction and Laboratory automation"},"license":"CC BY 4.0","licenseURL":"https://creativecommons.org/licenses/by/4.0/legalcode","social":{"twitter":"mojaie"}}},"markdownRemark":{"id":"dfa584ba-7d66-5235-84ba-ea1ec300e527","excerpt":"環境 Ubuntu 20.04.3 LTS MacOS 11.6.1 HomeBrew 3.3.8 Vagrant 2.2.19 singularity-ce version 3.9.0 MacにSingularityをインストール 公式 https://sylabs.io/guides/3.9/admin-guide…","html":"<h3>環境</h3>\n<ul>\n<li>Ubuntu 20.04.3 LTS</li>\n<li>\n<p>MacOS 11.6.1</p>\n<ul>\n<li>HomeBrew 3.3.8</li>\n<li>Vagrant 2.2.19</li>\n<li>singularity-ce version 3.9.0</li>\n</ul>\n</li>\n</ul>\n<h3>MacにSingularityをインストール</h3>\n<p>公式<br>\n<a href=\"https://sylabs.io/guides/3.9/admin-guide/installation.html#installation-on-windows-or-mac\">https://sylabs.io/guides/3.9/admin-guide/installation.html#installation-on-windows-or-mac</a></p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">brew <span class=\"token function\">install</span> --cask virtualbox vagrant vagrant-manager</span></span></code></pre></div>\n<p>途中で止まるので、システム環境設定->セキュリティとプライバシーからOracle America, Inc.を許可する。</p>\n<p>VM用フォルダを作成して移動、vagrant起動。VMのダウンロードが3GBくらいあるので注意。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">mkdir</span> vm-singularity-ce</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token builtin class-name\">cd</span> vm-singularity-ce</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">vagrant init sylabs/singularity-ce-3.9-ubuntu-bionic64</span></span></code></pre></div>\n<p>VirtualBoxの有効化に一旦再起動が必要。再起動しないと以下のようにBooting VMで止まる。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">==&gt; default: Booting VM...\nThere was an error while executing `VBoxManage`, a CLI used by Vagrant\nfor controlling VirtualBox. The command and stderr is shown below.\n\nCommand: [&quot;startvm&quot;, &quot;dfba51e9-b76e-45bc-95d5-317f9f66156e&quot;, &quot;--type&quot;, &quot;headless&quot;]\n\nStderr: VBoxManage: error: The virtual machine &#39;vm-singularity-ce_default_1639961910582_55602&#39; has terminated unexpectedly during startup with exit code 1 (0x1)\nVBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component MachineWrap, interface IMachine</code></pre></div>\n<p>インストールし直す場合は一旦vagrant destroy、rm Vagrantfileしてから再度vagrant init</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">vagrant destroy</span></span>\n<span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\"><span class=\"token function\">rm</span> Vagrantfile</span></span></code></pre></div>\n<p>仮想環境に接続して、インストールできていることを確認。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell-session\"><pre class=\"language-shell-session\"><code class=\"language-shell-session\"><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">vagrant <span class=\"token function\">ssh</span></span></span>\n<span class=\"token command\"><span class=\"token info punctuation\"><span class=\"token user\">vagrant@vagrant</span><span class=\"token punctuation\">:</span><span class=\"token path\">~</span></span><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">singularity version</span></span>\n<span class=\"token output\">3.9.0\n</span><span class=\"token command\"><span class=\"token shell-symbol important\">$</span> <span class=\"token bash language-bash\">vagrant <span class=\"token builtin class-name\">logout</span></span></span></code></pre></div>\n<p>その他vagrantのコマンド  </p>\n<ul>\n<li>vagrant reload: 既にVMが動いている時に、変更したVagrantfileを反映させる</li>\n<li>vagrant suspend: VMを一時停止する。upで再開</li>\n<li>vagrant halt: VMをgracefully shutdownする</li>\n</ul>\n<p>デフォルトでは、プロジェクトフォルダ(上記手順のvm-singularity-ceフォルダ)が仮想環境の/vagrantフォルダ(環境によっては/home/vagrant)としてマウントされている。  </p>\n<p>Vagrantfileのconfig.vm.synced_folderを編集してサーバ開発環境を追加でマウント、vagrant reload</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">config.vm.synced_folder &quot;/Users/hoge/Workspace/serverenv&quot;, &quot;/home/vagrant/serverenv&quot;</code></pre></div>\n<p>singularity-composeをインストール</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">sudo apt update\nsudo apt install python3-pip\npip3 install singularity-compose\nexport PATH=$PATH:/home/vagrant/.local/bin\nsingularity-compose up</code></pre></div>\n<h3>未解決</h3>\n<ul>\n<li>singularity-composeがまだよくわからない。singularity自体がオーケストレーション用途ではないと思うので今後どうなるかわからない。</li>\n<li>コンテナ同士の相互作用を考えるよりはdefファイルでいろいろまとめて一つのイメージとしてデプロイしたほうがいいかもしれない。</li>\n<li>Singularityは今後Sylabs社が企業向けのパッケージやSingularityCEと呼ばれるオープンソース版の開発を続け、従来のSingularityはLinuxのプロジェクトとして別系統で開発され、Apptainerという名称になるらしい…厄介…</li>\n</ul>","fields":{"slug":"/singularity-memo/"},"frontmatter":{"title":"Singularityインストールメモ","dateCreated":"December 20, 2021","dateModified":"December 20, 2021","tags":["Singularity","environment setup","MacOS"],"description":null}},"file":null},"pageContext":{"slug":"/singularity-memo/","draft":false,"image":null,"previous":{"fields":{"slug":"/julia-package-admin/"},"frontmatter":{"title":"Juliaパッケージ管理メモ","image":null,"draft":false}},"next":{"fields":{"slug":"/mac-vagrant-docker-memo/"},"frontmatter":{"title":"MacOSでVirturalBox+vagrantでDocker環境","image":null,"draft":false}}}},"staticQueryHashes":["2841359383","3266777773","401191528"]}